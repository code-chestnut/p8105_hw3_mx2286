p8105_hw3_mx2286
================
Mingye
2024-10-15

# Problem 1

**load data**

``` r
data("ny_noaa")
```

**Overall**

``` r
str(ny_noaa)
```

    ## tibble [2,595,176 × 7] (S3: tbl_df/tbl/data.frame)
    ##  $ id  : chr [1:2595176] "US1NYAB0001" "US1NYAB0001" "US1NYAB0001" "US1NYAB0001" ...
    ##  $ date: Date[1:2595176], format: "2007-11-01" "2007-11-02" ...
    ##  $ prcp: int [1:2595176] NA NA NA NA NA NA NA NA NA NA ...
    ##  $ snow: int [1:2595176] NA NA NA NA NA NA NA NA NA NA ...
    ##  $ snwd: int [1:2595176] NA NA NA NA NA NA NA NA NA NA ...
    ##  $ tmax: chr [1:2595176] NA NA NA NA ...
    ##  $ tmin: chr [1:2595176] NA NA NA NA ...
    ##  - attr(*, "spec")=
    ##   .. cols(
    ##   ..   id = col_character(),
    ##   ..   date = col_date(format = ""),
    ##   ..   prcp = col_integer(),
    ##   ..   snow = col_integer(),
    ##   ..   snwd = col_integer(),
    ##   ..   tmax = col_character(),
    ##   ..   tmin = col_character()
    ##   .. )

``` r
colMeans(is.na(ny_noaa)) * 100
```

    ##       id     date     prcp     snow     snwd     tmax     tmin 
    ##  0.00000  0.00000  5.61958 14.68960 22.80331 43.71025 43.71264

This dataset contains 2595176 rows and 7 columns. Variables include
weather station id, date of observation, (tenths of mm), snowfall (mm),
snow depth (mm), and min and max temperature (tenths of degrees C).

Several key variables contain many NA values:

`prcp`: 5.61958% missing value. `snow`: 14.68960% missing value. `snwd`:
22.80331% missing value. `tmax`: 43.71025% missing value. `tmin`:
43.71264% missing value.

**data cleaning**

``` r
ny_noaa %>% 
  count(snow) %>%
  arrange(desc(n))
```

    ## # A tibble: 282 × 2
    ##     snow       n
    ##    <int>   <int>
    ##  1     0 2008508
    ##  2    NA  381221
    ##  3    25   31022
    ##  4    13   23095
    ##  5    51   18274
    ##  6    76   10173
    ##  7     8    9962
    ##  8     5    9748
    ##  9    38    9197
    ## 10     3    8790
    ## # ℹ 272 more rows

``` r
ny_noaa = 
  ny_noaa %>% 
  separate(date, into = c("year", "month", "day"), convert = TRUE) %>% 
  mutate(
    tmax = as.numeric(tmax),
    tmin = as.numeric(tmin))
```

The most commonly observed value for snowfall is 0.

**plot 1**

``` r
ny_noaa %>% 
  group_by(id, year, month) %>% 
  filter(month %in% c(1, 7)) %>% 
  summarize(mean_tmax = mean(tmax, na.rm = TRUE, color = id)) %>% 
  ggplot(aes(x = year, y = mean_tmax, group = id)) + geom_point() + geom_path() +
  facet_grid(~month) +
  labs(title = "Mean monthly temperature for each station across years for January and July")
```

    ## `summarise()` has grouped output by 'id', 'year'. You can override using the
    ## `.groups` argument.

<img src="P8105_hw3_mx2286_files/figure-gfm/unnamed-chunk-4-1.png" width="90%" />

Temperatures in January show a gradual increase around 0°C over time. In
July, temperatures consistently range between 25-30°C across all years,
without any clear trend. In January, a few data points slightly above or
below 0°C could be considered outliers.

*plot 2*

``` r
tmax_tmin = ny_noaa |> 
  filter(!is.na(tmax) & !is.na(tmin)) |> 
  ggplot(aes(x=tmin, y=tmax)) +
  geom_hex(bins = 30) +
  labs(title = "Hexbin Plot of Tmax vs Tmin", x = "Tmin (°C)", y = "Tmax (°C)")

snow_dist = ny_noaa |> 
  filter(snow > 0 & snow < 100) |> 
  ggplot(aes(x=year, y=snow)) +
  geom_violin() +
  labs(title = "Snowfall Distribution (0 < Snowfall < 100) by Year", x = "Snowfall (mm)", y = "Year")

tmax_tmin + snow_dist
```

<img src="P8105_hw3_mx2286_files/figure-gfm/unnamed-chunk-5-1.png" width="90%" />

# Problem 2

*data cleaning*

``` r
# Read the NHANES accelerometer data, and clean column names for easier reference
accel = read.csv("nhanes_accel.csv") |> 
  janitor::clean_names()

# Read the NHANES covariate data, skipping the first 4 rows, and clean column names
covar = read.csv("nhanes_covar.csv", skip = 4) |> 
  janitor::clean_names() |> 
  filter(age >= 21, !is.na(sex), !is.na(age), !is.na(bmi), !is.na(education)) |> 
  mutate(
    sex = factor(sex, levels = c(1, 2), labels = c("Male", "Female")),
    education = factor(education, 
                       levels = c(1, 2, 3), 
                       labels = c("Less than high school", 
                                  "High school equivalent", 
                                  "More than high school"))
  )

# Merge the accelerometer and covariate datasets by 'seqn' (NHANES unique identifier)

mims = inner_join(accel, covar, by = "seqn")
```

*table*

``` r
# Merging and Summarizing
mims |> 
  group_by(sex, education) |> 
 summarize(count = n(), .groups = "drop") |> 
  pivot_wider(
    names_from = sex,
    values_from = count,
    values_fill = list(count = 0)  # fill missing combinations with 0
  ) |> 
  knitr::kable()
```

| education              | Male | Female |
|:-----------------------|-----:|-------:|
| Less than high school  |   27 |     28 |
| High school equivalent |   35 |     23 |
| More than high school  |   56 |     59 |

``` r
# Plotting Age Distributions by Sex and Education
mims |>
  group_by(sex, education) |> 
  ggplot(aes(x = sex, y = age, color = education)) +
  geom_boxplot() +
  labs(
    title = "Age distributions in each education category",
    x = "Sex", y = "Age"
  )
```

<img src="P8105_hw3_mx2286_files/figure-gfm/unnamed-chunk-7-1.png" width="90%" />

The “Less than high school” group has nearly equal representation of men
and women. In the “High school equivalent” category, men notably
outnumber women. In the “More than high school” group, the gender
balance is relatively even, with a slight majority of women.
Additionally, this group exhibits the widest range in age.

*Total Activity vs. Age by Sex and Education Level*

``` r
# Summing Activity Across Time Columns and Plotting
mims |> 
  rowwise() |>
  mutate(activity = sum(c_across(starts_with("min")), na.rm = TRUE)) |> 
  ungroup() |> 
  group_by(sex, education) |> 
  ggplot(aes(x = age, y = activity, color = sex)) +
  geom_point(alpha = 0.6, size = 2) +  
  geom_smooth(method = "loess") + 
  # Add a smoothed line (locally weighted regression) to show trends within each group
  facet_wrap(~education) +
  labs(
    title = "Total Activity vs. Age by Sex and Education Level",
    x = "Age", y = "Total Daily Activity"
  ) 
```

    ## `geom_smooth()` using formula = 'y ~ x'

<img src="P8105_hw3_mx2286_files/figure-gfm/unnamed-chunk-8-1.png" width="90%" />

Higher education levels are linked to more stable activity patterns
throughout life, while lower education levels display greater
variability and a sharper decline in activity, particularly among women.
Gender differences are most evident in the lower education groups, where
women tend to have higher activity levels in early adulthood but
experience a more pronounced decline with age.

*24-Hour Activity Time Courses by Education Level and Sex*

``` r
# Reshaping the Data and Plotting 24-Hour Activity Patterns
mims |> 
  pivot_longer(cols = starts_with("min"), 
               names_to = "minute", 
               names_prefix = "min", 
               values_to = "activity") |> 
  mutate(minute = as.numeric(minute))  |> # Convert 'minute' from character to numeric 
  group_by(minute, sex, education) |> 
  summarize(mean_activity = mean(activity, na.rm = TRUE), .groups = "drop") |> # Calculate the mean activity, ignoring NAs
  ggplot(aes(x = minute, y = mean_activity, color = sex)) +
  geom_point(alpha = 0.2, size = 1.5) +  
  geom_smooth(size = 1.2) +
  facet_wrap(~education, nrow = 3) +
  scale_x_continuous(breaks = seq(0, 1440, by = 120), 
                     labels = function(x) sprintf("%02d:00", x / 60)) + 
  #show time in HH:MM format
  labs(title = "24-Hour Activity Time Courses by Education Level and Sex",
       x = "Time of Day (Hours)",  # Clarified label
       y = "Mean Activity Level",
       color = "Sex")
```

    ## `geom_smooth()` using method = 'gam' and formula = 'y ~ s(x, bs = "cs")'

<img src="P8105_hw3_mx2286_files/figure-gfm/unnamed-chunk-9-1.png" width="90%" />

While there are minor differences in the timing and intensity of
activity peaks, the overall daily activity pattern is consistent across
all education levels. Activity levels are lower in the early morning and
late night, with noticeable peaks in the late morning and early
afternoon.

Females, particularly in the higher education groups, exhibit higher
activity levels in the morning. Men generally show slightly elevated
activity in the afternoon and evening, especially in the “Less than high
school” group.

Individuals with more education maintain higher and more consistent
activity levels throughout the day, perticularily for females, while
those with less education tend to have lower overall activity and
experience a decline in activity earlier in the day.

# Problem 3

**Data Cleaning**

``` r
# Loading and cleaning data for different months and years
bike20Jan <- read.csv("Jan 2020 Citi.csv") |> 
  janitor::clean_names() |> 
  mutate(year = 2020, month = "Jan")
bike20July <- read.csv("July 2020 Citi.csv") |> 
  janitor::clean_names() |> 
  mutate(year = 2020, month = "July")
bike24Jan <- read.csv("Jan 2024 Citi.csv") |> 
  janitor::clean_names() |> 
  mutate(year = 2024, month = "Jan")
bike24July <- read.csv("July 2024 Citi.csv") |> 
  janitor::clean_names() |> 
  mutate(year = 2024, month = "July")

# Combining the datasets and adding additional columns
citibike = bind_rows(bike20Jan, bike20July, bike24Jan, bike24July) |> 
  mutate(
    weekdays = factor(weekdays, 
                      levels =c("Monday", "Tuesday", "Wednesday", "Thursday", 
                                "Friday", "Saturday", "Sunday")),
    month = factor(month),
    year = factor(year),
   rideable_type = factor(rideable_type)
  )
# Checking the structure of the final dataset
str(citibike)
```

    ## 'data.frame':    99485 obs. of  9 variables:
    ##  $ ride_id           : chr  "4BE06CB33B037044" "26886E034974493B" "24DC56060EBE6260" "EEDC1053582D02E5" ...
    ##  $ rideable_type     : Factor w/ 2 levels "classic_bike",..: 1 1 1 1 1 1 1 1 1 1 ...
    ##  $ weekdays          : Factor w/ 7 levels "Monday","Tuesday",..: 2 3 5 7 5 7 7 7 4 2 ...
    ##  $ duration          : num  15.33 5.31 9.69 7 2.85 ...
    ##  $ start_station_name: chr  "Columbus Ave & W 95 St" "2 Ave & E 96 St" "Columbia St & Rivington St" "W 84 St & Columbus Ave" ...
    ##  $ end_station_name  : chr  "E 53 St & Madison Ave" "1 Ave & E 110 St" "Grand St & Elizabeth St" "Columbus Ave & W 72 St" ...
    ##  $ member_casual     : chr  "member" "member" "member" "member" ...
    ##  $ year              : Factor w/ 2 levels "2020","2024": 1 1 1 1 1 1 1 1 1 1 ...
    ##  $ month             : Factor w/ 2 levels "Jan","July": 1 1 1 1 1 1 1 1 1 1 ...

The final dataset consists of 99,485 observations and 9 variables,
including `ride_id`, `rideable_type`, `weekdays`, `duration`,
`start_station_name`, `end_station_name`, `member_casual`, `year`,
`month`.

*table 1*

``` r
#Summary of Total Rides by Year, Month, and Rider Type
citibike |> 
  group_by(year, month, member_casual) |>
  summarize(number = n(),.groups = "drop") |> 
  pivot_wider(
    names_from = member_casual,
    values_from = number) |> 
  knitr::kable() # Display the table in a clean format using knitr::kable()
```

| year | month | casual | member |
|:-----|:------|-------:|-------:|
| 2020 | Jan   |    984 |  11436 |
| 2020 | July  |   5637 |  15411 |
| 2024 | Jan   |   2108 |  16753 |
| 2024 | July  |  10894 |  36262 |

From 2020 to 2024, there has been a notable increase in total rides,
with a significant surge observed in July 2024. This trend likely
reflects growing popularity, possibly driven by expanded infrastructure,
improved accessibility, or rising public interest in bike-sharing
services. *table 2*

``` r
#Most Popular Starting Stations for July 2024
citibike |> 
  filter(year == 2024, month == "July") |>  
  group_by(start_station_name) |>  
  summarize(total_ride = n()) |>  
  arrange(desc(total_ride)) |>  
  slice_max(total_ride, n = 5) |>
  knitr::kable(caption = "Top 5 Most Popular Starting Stations for July 2024")
```

| start_station_name       | total_ride |
|:-------------------------|-----------:|
| Pier 61 at Chelsea Piers |        163 |
| University Pl & E 14 St  |        155 |
| W 21 St & 6 Ave          |        152 |
| West St & Chambers St    |        150 |
| W 31 St & 7 Ave          |        146 |

Top 5 Most Popular Starting Stations for July 2024

*Median Ride Duration by Day of Week, Month, and Year*

``` r
# Group data by year, month, and day of the week
citibike |> 
  group_by(year, month, weekdays) |>  
  summarize(median_duration = median(duration)) |> 
  ggplot(aes(x = weekdays, y = median_duration, color = factor(year))) +
  geom_point(aes(group = year)) +
  geom_line(aes(group = year)) +  
  facet_wrap(~ month + year, ncol = 2, nrow = 2) +  # Create facets by month and year (2x2 layout)
  labs(title = "Median Ride Duration by Day of Week, Month, and Year",
       x = "Day of the Week", 
       y = "Median Ride Duration (minutes)", 
       color = "Year")
```

    ## `summarise()` has grouped output by 'year', 'month'. You can override using the
    ## `.groups` argument.

<img src="P8105_hw3_mx2286_files/figure-gfm/unnamed-chunk-13-1.png" width="90%" />

Ride durations in the colder month of January are noticeably shorter
compared to those in July, likely due to harsher weather conditions,
which make biking less comfortable or practical. In contrast, the warmer
month of July sees significantly longer rides, especially on weekends.
This trend is evident in both 2020 and 2024.

The increase in weekend ride durations during July suggests that many
riders are taking advantage of the favorable summer weather for
recreational activities or leisurely outings. Weekends may also provide
more free time for longer trips, contributing to the spike in usage.
Additionally, the data indicates that seasonal factors, such as holidays
or vacations in July, could further influence the increased duration of
rides during this period.

*Impact of Month, Membership Status, and Bike Type 2024*

``` r
citibike |> 
  filter(year == 2024) |> # Filter for rides in 2024
  ggplot(aes(x = month, y = duration, color = rideable_type)) +
  geom_boxplot(outlier.alpha = 0.7) +  # Add boxplots with semi-transparent outliers
  facet_wrap(~ member_casual) +
  labs(title = "Impact of Month, Membership Status, and Bike Type 2024",
       x = "Month",
       y = "Ride Duration (minutes)",
       color = "Bike Type") +# Legend for bike type
  theme_minimal()  # Optional: Cleaner theme for readability
```

<img src="P8105_hw3_mx2286_files/figure-gfm/unnamed-chunk-14-1.png" width="90%" />

Electric bikes are frequently chosen for longer rides, with casual
riders showing a clear preference for them during extended trips. This
may be due to the additional ease and speed that electric bikes provide,
making them an attractive option for non-members who may be riding for
leisure or covering longer distances.

In contrast, members tend to exhibit more consistent ride durations
regardless of bike type. This suggests that members, who may use the
service more regularly for commuting or errands, prioritize convenience
and efficiency over ride length, leading to more uniform usage patterns
across both electric and traditional bikes.
